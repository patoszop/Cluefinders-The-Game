<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="color-scheme" content="light">
  <link rel="stylesheet" href="style.css" />
  <title>Cluefinders ‚Äì Level 3</title>
  <style>
    /* Unique hiding technique for Level 3: Hiding the question text - zachowano */
    #hiddenQuestion {
      color: #f0f0f0; 
      transition: color 0.5s;
      margin-top: 20px;
      font-weight: bold;
      cursor: default;
    }

    #rangeInput {
        margin-top: 15px;
        width: 80%;
    }
  </style>
</head>
<body>

  <h1>Level 3</h1>
  <p>To pass this level, you must find the hidden question and set the visible slider to the correct value.</p>
  <p>The correct answer is a four-digit year.</p>
  
  <button onclick="confirmExitToHub()" style="margin-top: 20px;">Back to Hub</button>

  <div id="visibleClue">
      <strong>Clue:</strong>
      <p>The solution requires a four-digit year.</p>
      <p>How do you reveal elements hidden by color?</p>
  </div>

  <input type="range" id="rangeInput" min="1500" max="1800" value="1500" step="1" oninput="updateValue(this.value)"/>
  <p>Current Year: <span id="currentValue">1500</span></p>

  <button id="submitBtn">Submit Year</button>

  <div id="levelEnd" style="display: none; margin-top: 30px;">
    <p>Success! You solved the riddle.</p><br>
    <a href="hub.html">Go to hub.</a>
    <a href="level4.html" onclick="unlockNextLevel(4)">Proceed to level 4.</a>
  </div>

  <div id="hiddenQuestion">
    In what year did Isaac Newton publish his discovery of the law of gravity?
  </div>

  <script>
    // --- Updated text visibility to be invisible to various themes and external extensions ---
    function syncHiddenTextColor() {
      const bgColor = getComputedStyle(document.body).backgroundColor;
      document.getElementById("hiddenQuestion").style.color = bgColor;
    }
    syncHiddenTextColor();
    window.addEventListener("load", syncHiddenTextColor);

    // --- Updated Functionality: Exit Confirmation with improved message ---
    function confirmExitToHub() {
        const exitConfirmed = confirm("Are you sure you want to exit the current puzzle and return to the Hub? Any temporary clues or unsaved input will be lost.");
        if (exitConfirmed) {
            window.location.href = 'hub.html';
        }
    }

    const rangeInput = document.getElementById("rangeInput");
    const currentValue = document.getElementById("currentValue");
    const submitBtn = document.getElementById("submitBtn");
    const levelEnd = document.getElementById("levelEnd");
    
    // The correct year is 1687
    const correctYear = 1687; 
    
    // Change the display value of the slider
    function updateValue(value) {
      currentValue.textContent = value;
    }
    window.updateValue = updateValue;
    
    // Function to update progress in localStorage
    function unlockNextLevel(levelNumber) {
      const currentProgress = parseInt(localStorage.getItem("userprogress") || "1");
      if (levelNumber > currentProgress) {
        localStorage.setItem("userprogress", levelNumber.toString());
        console.log(`Progress updated to Level ${levelNumber}`);
      }
    }
    window.unlockNextLevel = unlockNextLevel;

    // Check input code on submission
    submitBtn.addEventListener("click", () => {
      if (parseInt(rangeInput.value) === correctYear || parseInt(rangeInput.value) === 1687) {
        levelEnd.style.display = "block";
        unlockNextLevel(4);
      } else {
        alert("Incorrect value! Use the clue to understand how to find the hidden question.");
      }
    });

    // Dev helper ‚Äî type `devOutlines()` in the console
    function devOutlines() {
      const all = document.querySelectorAll("*");
      all.forEach(el => {
        const style = window.getComputedStyle(el);
        const isVisible = style.display !== "none" && style.visibility !== "hidden" && style.opacity !== "0";

        if (!isVisible || el.offsetWidth === 0 || el.offsetHeight === 0) {
          el.style.outline = "2px dashed red";
        } else {
          el.style.outline = "1px dashed limegreen";
        }
      });

      console.log("üîç Dev outlines added (red = hidden, green = visible)");
    }
  </script>
</body>
</html>