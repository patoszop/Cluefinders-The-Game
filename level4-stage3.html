<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <link rel="stylesheet" href="style.css" />
  <title>Cluefinders ‚Äì Level 4 (Stage 3)</title>
  <style>
    /* Styling for the date and time inputs - zachowano */
    #dateInput, #timeInput {
        margin: 20px 10px;
        padding: 10px;
        font-size: 1.2em;
        /* Using the system-default look for unique input types */
        font-family: 'Courier New', Courier, monospace;
    }
    
    #levelEnd a {
        margin: 10px; /* Spacing for the final buttons */
    }
  </style>
</head>
<body>
  <h1>Level 4 ‚Äì Stage 3</h1>
  <p>Enter the date and time to complete the level. You must find the exact match.</p>
  
  <a href="level4-stage2.html">Go back to Stage 2</a>
  <button onclick="confirmExitToHub()" style="margin-left: 10px;">Back to Hub</button>

  <div id="inputContainer" style="margin-top: 50px;">
    <label for="dateInput">Date:</label>
    <input type="date" id="dateInput" value="2000-01-01" />
    <br><br>
    <label for="timeInput">Time:</label>
    <input type="time" id="timeInput" value="00:00" />
    <br><br>
    <button id="submitBtn">Submit</button>
  </div>

  <div id="levelEnd" style="display: none; margin-top: 30px;">
    <p>Level 4 complete! You are almost there.</p><br>
    <a href="hub.html">Go to hub.</a>
    <a href="level5.html" onclick="unlockNextLevel(5)">Proceed to level 5.</a>
  </div>

  <script>
    // --- Updated Functionality: Exit Confirmation with improved message ---
    function confirmExitToHub() {
        const exitConfirmed = confirm("Are you sure you want to exit the current puzzle and return to the Hub? Any temporary clues or unsaved input will be lost.");
        if (exitConfirmed) {
            window.location.href = 'hub.html';
        }
    }

    const dateInput = document.getElementById("dateInput");
    const timeInput = document.getElementById("timeInput");
    const submitBtn = document.getElementById("submitBtn");
    const levelEnd = document.getElementById("levelEnd");
    
    // Correct date and time from the clues: Date: 1987-04-16, Time: 11:27
    const correctDate = "1987-04-16";
    const correctTime = "11:27";
    
    // Function to update progress in localStorage
    function unlockNextLevel(levelNumber) {
      const currentProgress = parseInt(localStorage.getItem("userprogress") || "1");
      if (levelNumber > currentProgress) {
        localStorage.setItem("userprogress", levelNumber.toString());
        console.log(`Progress updated to Level ${levelNumber}`);
      }
    }
    window.unlockNextLevel = unlockNextLevel;

    // Check input code on submission
    submitBtn.addEventListener("click", () => {
      const enteredDate = dateInput.value;
      const enteredTime = timeInput.value;

      if (enteredDate === correctDate && enteredTime === correctTime) {
        levelEnd.style.display = "block";
        unlockNextLevel(5); // Unlock Level 5 on success
      } else {
        alert("Incorrect combination! Check your clues for the exact date and time .");
      }
    });

    // Dev helper ‚Äî type `devOutlines()` in the console
    function devOutlines() {
      const all = document.querySelectorAll("*");
      all.forEach(el => {
        const style = window.getComputedStyle(el);
        const isVisible = style.display !== "none" && style.visibility !== "hidden" && style.opacity !== "0";

        if (!isVisible || el.offsetWidth === 0 || el.offsetHeight === 0) {
          el.style.outline = "2px dashed red";
        } else {
          el.style.outline = "1px dashed limegreen";
        }
      });

      console.log("üîç Dev outlines added (red = hidden, green = visible)");
    }
  </script>
</body>
</html>